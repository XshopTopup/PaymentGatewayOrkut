<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dokumentasi API Pembayaran QRIS</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
    <header class="bg-blue-600 text-white py-6">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl font-bold">Dokumentasi API Pembayaran QRIS</h1>
            <p class="mt-2">API yang dioptimalkan untuk transaksi pembayaran berbasis QRIS</p>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <section id="pendahuluan" class="mb-12">
            <h2 class="text-2xl font-semibold mb-4">Pendahuluan</h2>
            <p class="text-gray-700">
                API Pembayaran QRIS memungkinkan pembuatan dan verifikasi transaksi pembayaran berbasis QRIS.
                API ini menjamin keunikan Transaction ID dan nominal dalam periode 24 jam untuk mencegah konflik.
                Fitur optimasi meliputi caching untuk pengecekan status pembayaran, pengurangan pengambilan data API,
                dan pembersihan otomatis data yang kadaluarsa.
                Dokumentasi ini merinci endpoint, parameter, respons, dan fitur optimasi.
            </p>
        </section>

        <section id="endpoint" class="mb-12">
            <h2 class="text-2xl font-semibold mb-4">Endpoint API</h2>

            <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                <h3 class="text-xl font-semibold mb-2">POST /api/topup</h3>
                <p class="text-gray-700 mb-4">
                    Menghasilkan kode QRIS untuk transaksi pembayaran dengan nominal dan Transaction ID yang unik.
                    Transaction ID diformat sebagai <code>TRX<dayStart><counter></code> (contoh: <code>TRX1623456000000001</code>),
                    memastikan keunikan dalam periode 24 jam. Sufiks unik (1-999) ditambahkan ke nominal untuk membuat total unik.
                </p>
                
                <h4 class="font-semibold mb-2">Body Permintaan</h4>
                <pre class="bg-gray-800 text-white p-4 rounded-lg overflow-x-auto">
{
    "amount": number, // Wajib, bilangan bulat positif (contoh: 10000)
    "username": string // Wajib, pengenal pengguna
}
                </pre>

                <h4 class="font-semibold mb-2 mt-4">Respons</h4>
                <pre class="bg-gray-800 text-white p-4 rounded-lg overflow-x-auto">
{
    "id": string, // Transaction ID unik (contoh: "TRX1623456000000001")
    "qris": string, // URL gambar QRIS (contoh: "http://host/qris/OK1234567890.jpg")
    "expireAt": number, // Timestamp kadaluarsa (milidetik)
    "amount": number, // Nominal asli yang diminta
    "kodeunik": number, // Sufiks unik (1-999)
    "total": number, // Total nominal yang harus dibayar (amount + kodeunik)
    "note": string // Instruksi pembayaran
}
                </pre>

                <h4 class="font-semibold mb-2 mt-4">Respons Error</h4>
                <ul class="list-disc pl-5 text-gray-700">
                    <li>400 Bad Request: Nominal tidak valid atau bukan bilangan bulat positif.</li>
                    <li>429 Too Many Requests: Tidak ada nominal unik yang tersedia.</li>
                    <li>500 Internal Server Error: Gagal menghasilkan QRIS.</li>
                </ul>

                <h4 class="font-semibold mb-2 mt-4">Contoh</h4>
                <pre class="bg-gray-800 text-white p-4 rounded-lg overflow-x-auto">
curl -X POST http://localhost:3002/api/topup \
-H "Content-Type: application/json" \
-d '{"amount": 10000, "username": "john_doe"}'
                </pre>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                <h3 class="text-xl font-semibold mb-2">GET /api/check-payment/:id</h3>
                <p class="text-gray-700 mb-4">
                    Memeriksa status transaksi pembayaran berdasarkan Transaction ID.
                    Menggunakan respons API yang di-cache (validitas 30 detik) dan hanya mengambil 10 transaksi terbaru
                    untuk mengurangi latensi dan beban server.
                </p>
                
                <h4 class="font-semibold mb-2">Parameter</h4>
                <ul class="list-disc pl-5 text-gray-700">
                    <li><code>id</code>: Transaction ID (contoh: "TRX1623456000000001")</li>
                </ul>

                <h4 class="font-semibold mb-2 mt-4">Respons</h4>
                <pre class="bg-gray-800 text-white p-4 rounded-lg overflow-x-auto">
{
    "status": string, // "paid" (dibayar), "pending" (menunggu), atau "expired" (kadaluarsa)
    "paymentDetails": { // Hanya disertakan jika status "paid"
        "paymentId": string, // Referensi pembayaran dari gateway
        "paymentTime": string, // Timestamp pembayaran
        "paymentMethod": string, // Metode pembayaran (contoh: merek QRIS)
        "amount": number, // Nominal asli
        "uniqueAmount": number, // Total nominal yang dibayar
        "uniqueSuffix": number // Sufiks unik
    }
}
                </pre>

                <h4 class="font-semibold mb-2 mt-4">Respons Error</h4>
                <ul class="list-disc pl-5 text-gray-700">
                    <li>404 Not Found: Transaksi tidak ditemukan.</li>
                    <li>500 Internal Server Error: Gagal memeriksa status pembayaran.</li>
                </ul>

                <h4 class="font-semibold mb-2 mt-4">Contoh</h4>
                <pre class="bg-gray-800 text-white p-4 rounded-lg overflow-x-auto">
curl http://localhost:3002/api/check-payment/TRX1623456000000001
                </pre>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold mb-2">GET /qris/:filename</h3>
                <p class="text-gray-700 mb-4">Mengambil gambar QRIS untuk transaksi.</p>
                
                <h4 class="font-semibold mb-2">Parameter</h4>
                <ul class="list-disc pl-5 text-gray-700">
                    <li><code>filename</code>: Nama file gambar QRIS (contoh: "OK1234567890.jpg")</li>
                </ul>

                <h4 class="font-semibold mb-2 mt-4">Respons</h4>
                <p class="text-gray-700">Mengembalikan file gambar QRIS (JPEG).</p>

                <h4 class="font-semibold mb-2 mt-4">Respons Error</h4>
                <ul class="list-disc pl-5 text-gray-700">
                    <li>404 Not Found: File tidak ditemukan.</li>
                </ul>
            </div>
        </section>

        <section id="optimasi" class="mb-12">
            <h2 class="text-2xl font-semibold mb-4">Optimasi API</h2>
            <p class="text-gray-700 mb-4">
                API ini mencakup beberapa optimasi untuk memastikan performa, keandalan, dan skalabilitas:
            </p>
            <ul class="list-disc pl-5 text-gray-700">
                <li>
                    <strong>Transaction ID Unik</strong>: Transaction ID dibuat dalam format
                    <code>TRX<dayStart><counter></code> (contoh: <code>TRX1623456000000001</code>),
                    di mana <code>dayStart</code> adalah timestamp awal hari, dan <code>counter</code>
                    adalah nomor urut harian (hingga 999999). Ini menjamin tidak ada duplikasi ID dalam 24 jam.
                </li>
                <li>
                    <strong>Nominal Unik</strong>: Sufiks unik (1-999) ditambahkan ke nominal yang diminta untuk membuat
                    total unik (contoh: 10000 + 123 = 10123). Ini mencegah konflik dalam periode 24 jam.
                    Jika tidak ada sufiks unik yang tersedia, API mengembalikan error 429.
                </li>
                <li>
                    <strong>Pengecekan Status yang Dioptimalkan</strong>: Endpoint <code>/api/check-payment/:id</code>
                    hanya mengambil 10 transaksi terbaru dari API eksternal untuk mengurangi latensi dan beban server.
                    Respons API di-cache selama 30 detik untuk meminimalkan panggilan berulang.
                </li>
                <li>
                    <strong>Pembersihan Otomatis</strong>: Transaksi yang kadaluarsa, nominal unik, dan counter ID
                    dibersihkan setiap 5 menit. Catatan transaksi yang telah diproses dihapus setiap jam jika melebihi
                    1000 entri. Gambar QRIS dihapus setelah pembayaran atau kadaluarsa untuk menghemat penyimpanan.
                </li>
            </ul>
        </section>

        <section id="catatan" class="mb-12">
            <h2 class="text-2xl font-semibold mb-4">Catatan Tambahan</h2>
            <ul class="list-disc pl-5 text-gray-700">
                <li>Transaksi kadaluarsa setelah 15 menit.</li>
                <li>Transaction ID dan nominal dijamin unik dalam periode 24 jam.</li>
                <li>Gambar QRIS dihapus otomatis setelah pembayaran atau kadaluarsa.</li>
                <li>Untuk volume transaksi tinggi, pertimbangkan menggunakan database (contoh: Redis) untuk menyimpan
                    nominal unik dan counter ID.</li>
                <li>Kunci API dan Merchant ID harus disimpan dengan aman dalam variabel lingkungan.</li>
            </ul>
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-4">
        <div class="container mx-auto px-4 text-center">
            <p>Â© 2025 API Pembayaran QRIS. Hak cipta dilindungi.</p>
        </div>
    </footer>
</body>
</html>